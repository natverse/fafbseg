<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Query the FlyWire CAVE annotation system — flywire_cave_query • fafbseg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Query the FlyWire CAVE annotation system — flywire_cave_query"><meta name="description" content="Query the FlyWire CAVE annotation system"><meta property="og:description" content="Query the FlyWire CAVE annotation system"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fafbseg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.14.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a></li>
    <li><a class="dropdown-item" href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a></li>
    <li><a class="dropdown-item" href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a></li>
    <li><a class="dropdown-item" href="../articles/fafbseg-catmaid-legacy-info.html">fafbseg-catmaid-legacy-info</a></li>
    <li><a class="dropdown-item" href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a></li>
    <li><a class="dropdown-item" href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../SUPPORT.html">Help</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://natverse.org/">natverse</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natverse/fafbseg"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Query the FlyWire CAVE annotation system</h1>
      <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/master/R/cave.R" class="external-link"><code>R/cave.R</code></a></small>
      <div class="d-none name"><code>flywire_cave_query.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Query the FlyWire CAVE annotation system</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flywire_cave_query</span><span class="op">(</span></span>
<span>  <span class="va">table</span>,</span>
<span>  datastack_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"fafbseg.cave.datastack_name"</span>, <span class="st">"flywire_fafb_production"</span><span class="op">)</span>,</span>
<span>  version <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  timestamp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  live <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">version</span><span class="op">)</span>,</span>
<span>  timetravel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter_in_dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_out_dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_regex_dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  select_columns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fetch_all_rows <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-table">table<a class="anchor" aria-label="anchor" href="#arg-table"></a></dt>
<dd><p>The name of the table (or view, see views section) to query</p></dd>


<dt id="arg-datastack-name">datastack_name<a class="anchor" aria-label="anchor" href="#arg-datastack-name"></a></dt>
<dd><p>defaults to "flywire_fafb_production". See
<a href="https://global.daf-apis.com/info/" class="external-link">https://global.daf-apis.com/info/</a> for other options.</p></dd>


<dt id="arg-version">version<a class="anchor" aria-label="anchor" href="#arg-version"></a></dt>
<dd><p>An optional CAVE materialisation version number. See details
and examples.</p></dd>


<dt id="arg-timestamp">timestamp<a class="anchor" aria-label="anchor" href="#arg-timestamp"></a></dt>
<dd><p>An optional timestamp as a string or POSIXct, interpreted as
UTC when no timezone is specified.</p></dd>


<dt id="arg-live">live<a class="anchor" aria-label="anchor" href="#arg-live"></a></dt>
<dd><p>Whether to use live query mode, which updates any root ids to
their current value (or to another <code>timestamp</code> when provided). Values
of <code>TRUE</code> or <code>1</code> select CAVE's <em>Live</em> mode, while <code>2</code>
selects <code>Live live</code> mode which gives access even to annotations that
are not part of a materialisation version. See section <b>Live and Live
Live queries</b> for details.</p></dd>


<dt id="arg-timetravel">timetravel<a class="anchor" aria-label="anchor" href="#arg-timetravel"></a></dt>
<dd><p>Whether to interpret <code>version</code>/<code>timestamp</code> as a
defined point in the past to which the very <em>latest</em> annotations will
be sent back in time, recalculating root ids as necessary.</p></dd>


<dt id="arg-filter-in-dict-filter-out-dict-filter-regex-dict">filter_in_dict, filter_out_dict, filter_regex_dict<a class="anchor" aria-label="anchor" href="#arg-filter-in-dict-filter-out-dict-filter-regex-dict"></a></dt>
<dd><p>Optional arguments
consisting of key value lists that restrict the returned rows (keeping only
matches or filtering out matches). Commonly used to selected rows for
specific neurons. See examples and CAVE documentation for details.</p></dd>


<dt id="arg-select-columns">select_columns<a class="anchor" aria-label="anchor" href="#arg-select-columns"></a></dt>
<dd><p>Either a character vector naming columns or a python
dict (required if the query involves multiple tables).</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>a 0-indexed row number, allows you to page through long results
(but see section <b>CAVE Row Limits</b> for some caveats)</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>whether to limit the number of rows per query (<code>NULL</code>
implies no client side limit but there is typically a server side limit of
500,000 rows).</p></dd>


<dt id="arg-fetch-all-rows">fetch_all_rows<a class="anchor" aria-label="anchor" href="#arg-fetch-all-rows"></a></dt>
<dd><p>Whether to fetch all rows of a query that exceeds limit
(default <code>FALSE</code>). See section <b>CAVE Row Limits</b> for some
caveats.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to the query method. See examples and
details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>tibble</code>. Note that xyzmatrix can be used on single columns
  containing XYZ locations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>CAVE (Connectome Annotation Versioning Engine) provides a shared
  infrastructure for a number of connectomics projects involving Sebastian
  Seung's group at Princeton and collaborators at the Allen Institute. There
  is both a backend system running on their servers and a Python client for
  end users.</p>
<p>You can find out more at <a href="https://caveclient.readthedocs.io/" class="external-link">https://caveclient.readthedocs.io/</a> as well
  as looking at the Python notebooks on the github repo
  <a href="https://github.com/seung-lab/CAVEclient" class="external-link">https://github.com/seung-lab/CAVEclient</a>.</p>
<p>The annotation system shares authentication infrastructure with the rest of
  the FlyWire API (see <code><a href="flywire_set_token.html">flywire_set_token</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="cave-materialisation-versions-and-timestamps">CAVE Materialisation Versions and Timestamps<a class="anchor" aria-label="anchor" href="#cave-materialisation-versions-and-timestamps"></a></h2>
    <p>CAVE has a concept of
  table snapshots identified by an integer materialization <code>version</code>
  number. In some cases you may wish to query a table at this defined version
  number so that you can avoid root_ids changing during an analysis. Your
  calls will also be faster since no root id updates are required.</p>
<p>Note however that materialisation versions expire at which point the
  corresponding version of the database is expunged. However it is still
  possible to find the timestamp for an expired materialisation version.
  <code>flywire_cave_query</code> does this automatically using
  <code><a href="flywire_timestamp.html">flywire_timestamp</a></code>. In these circumstances queries will again
  be slower (quite possibly slower than the live query) since all root ids
  must be recalculated to match the timestamp.</p>
<p>CAVE's ability to handle different timepoints is key to analysis for a
  continually evolving segmentation but is frankly a little difficult for
  users to work with. You will find things simplest if you either</p><ul><li><p>use a long-term support (LTS) version, which will not expire such as
  the 630 version for the June 2023 public release or the 783 version to
  accompany the published FlyWire papers.</p></li>
<li><p>use the latest CAVE version</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="live-and-live-live-queries">Live and Live Live queries<a class="anchor" aria-label="anchor" href="#live-and-live-live-queries"></a></h2>
    <p>CAVE versions the segmentation and
  annotation tables with shared version numbers. When a dataset is stable,
  using this single version works well. However, we have found that this
  arrangement is not ideal in many situations, as annotations often evolve
  even though the segmentation is static.</p>
<p>CAVE has two options to update annotations to a different point in time:</p><ol><li><p><b>Live queries</b> take the contents of a table at some version and
  updates the root ids to match a later timepoint (usually now). However the
  set of annotations remains stuck at the selected version. The starting
  materialisation version is chosen to be the most recent one preceding the
  requested timepoint.</p></li>
<li><p><b>Live live queries</b> (CAVE terminology, <code>live=2</code>) can return
  the state of an annotation table at an arbitrary timepoint. This includes
  annotations that have not yet been incorporated into a released
  materialisation version.</p></li>
</ol><p>We have found that these different query modes do not cover all of our use
  cases. In particular we often want to be able to travel <em>backwards</em> in
  time, taking a current annotation table and mapping the root_ids onto an
  earlier state of the segmentation. You can access this functionality by
  setting the <code>timetravel</code> argument. Under the hood this uses a live
  live query using a now timestamp, followed by translating all root ids back
  to their earlier state using the associated supervoxel ids.</p>
    </div>
    <div class="section level2">
    <h2 id="cave-views">CAVE Views<a class="anchor" aria-label="anchor" href="#cave-views"></a></h2>
    <p>In addition to regular database tables, CAVE provides
  support for <b>views</b>. These are based on a SQL query which typically
  aggregates or combines multiple tables. For an example an aggregation might
  define the total number of output synapses for some selected neurons.</p>
<p>At present there are several restrictions on views. For example, you can
  only fetch views using an unexpired materialisation version (and you cannot
  specify a timepoint using a timestamp) . Furthermore some <code>filter_in,
  filter_out</code> queries using columns created by the SQL statement may not be
  possible.</p>
    </div>
    <div class="section level2">
    <h2 id="cave-row-limits">CAVE Row Limits<a class="anchor" aria-label="anchor" href="#cave-row-limits"></a></h2>
    <p>CAVE servers limit the number of rows that can be
  returned for any query, typically 500,000 rows. For many queries you can
  still use increasing values of <code>offset</code> to page through the results.
  However, there appear to be restrictions to this. In particular for the
  synapse table, rows are returned in <em>random</em> order. Therefore, even if
  you set your own row <code>limit</code> lower than the server's, you still cannot
  fetch all the rows of your query. Other tables (e.g. nuclei) do not have
  this limitation.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="flywire_cave_client.html">flywire_cave_client</a></code></p>
<p>Other cave-queries:
<code><a href="flywire_timestamp.html">flywire_timestamp</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># note use of limit to restrict the number of rows (must be integer)</span></span></span>
<span class="r-in"><span><span class="va">n10</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'nuclei_v1'</span>, limit<span class="op">=</span><span class="fl">10L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">n10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     id             created superceded_id valid     volume pt_supervoxel_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2338 2021-06-23 19:56:18            NA     t  0.2616115                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 3078 2021-06-23 19:55:39            NA     t  4.1247949                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 3292 2021-06-23 19:56:19            NA     t  0.2737357                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 3502 2021-06-23 19:55:39            NA     t  6.7878502                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 4404 2021-06-23 19:55:51            NA     t  0.8473395                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 4446 2021-06-23 19:55:50            NA     t 58.8006195                0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   pt_root_id           pt_position     bb_start_position       bb_end_position</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          0 95520, 254368, 218600 94528, 253184, 218520 96384, 255776, 218680</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          0 97472, 252352, 218040 96128, 248992, 217640 98944, 254720, 218600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          0 97280, 250784, 219320 96544, 249408, 219240 98080, 251744, 219520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          0 98304, 253376, 216480 96928, 250752, 215240 99936, 256000, 217240</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          0 81280, 295968, 186680 80640, 294496, 186320 82048, 297600, 187440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          0 84128, 291584, 193400 81504, 288000, 190240 87104, 295904, 196280</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">nuclei_v1</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'nuclei_v1'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">points3d</span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/elmr" class="external-link">elmr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># calculate signed distance to FAFB surface</span></span></span>
<span class="r-in"><span><span class="co"># NB this surface is not a perfect fit in the optic lobes</span></span></span>
<span class="r-in"><span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">d</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/pointsinside.html" class="external-link">pointsinside</a></span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span>, <span class="va">FAFB.surf</span>,</span></span>
<span class="r-in"><span>  rval <span class="op">=</span> <span class="st">'dist'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">points3d</span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  col<span class="op">=</span><span class="fu">matlab</span><span class="fu">::</span><span class="fu">jet.colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">d</span>,<span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot3d</span><span class="op">(</span><span class="va">FAFB</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># Example of a query on a table</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># the Princeton (mostly) and Cambridge groups have tagged some bodies as</span></span></span>
<span class="r-in"><span><span class="co"># not a neuron - these are often glia.</span></span></span>
<span class="r-in"><span><span class="va">nans</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span><span class="st">'neuron_information_v2'</span>,</span></span>
<span class="r-in"><span>  filter_in_dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tag<span class="op">=</span><span class="st">'not a neuron'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nans</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nans</span><span class="op">$</span><span class="va">user_id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">psp_351</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'proofreading_status_public_v1'</span>,</span></span>
<span class="r-in"><span>  version<span class="op">=</span><span class="fl">351</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the last listed materialisation version</span></span></span>
<span class="r-in"><span><span class="va">fcc</span><span class="op">=</span><span class="fu"><a href="flywire_cave_client.html">flywire_cave_client</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lastv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">fcc</span><span class="op">$</span><span class="va">materialize</span><span class="op">$</span><span class="fu">get_versions</span><span class="op">(</span><span class="op">)</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># pull that</span></span></span>
<span class="r-in"><span><span class="va">psp_last</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'proofreading_status_public_v1'</span>,</span></span>
<span class="r-in"><span>  version<span class="op">=</span><span class="va">lastv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># timetravel query example</span></span></span>
<span class="r-in"><span><span class="co"># note use of allow_missing_lookups=T as not infrequently materialisation</span></span></span>
<span class="r-in"><span><span class="co"># can fail for a neuron</span></span></span>
<span class="r-in"><span><span class="va">cambridge_celltypes_v2.783</span> <span class="op">&lt;-</span> <span class="fu">flywire_cave_query</span><span class="op">(</span><span class="st">'cambridge_celltypes_v2'</span>, version <span class="op">=</span> <span class="fl">783</span>,</span></span>
<span class="r-in"><span>  timetravel<span class="op">=</span><span class="cn">TRUE</span>, allow_missing_lookups<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  select_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cambridge_celltypes_v2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"tag"</span>, <span class="st">"pt_root_id"</span>, <span class="st">"pt_supervoxel_id"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># querying by regex on a cell type in this table</span></span></span>
<span class="r-in"><span><span class="va">mbon012</span><span class="op">&lt;-</span> <span class="fu">flywire_cave_query</span><span class="op">(</span><span class="st">'cambridge_celltypes_v2'</span>, version <span class="op">=</span> <span class="fl">783</span>,</span></span>
<span class="r-in"><span>timetravel<span class="op">=</span><span class="cn">TRUE</span>, allow_missing_lookups<span class="op">=</span><span class="cn">TRUE</span>, filter_regex_dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>tag<span class="op">=</span><span class="st">'MBON0[12]'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

