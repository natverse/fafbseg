<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="flywire2fafb maps points FlyWire-&amp;gt;FAFB
fafb2flywire maps points FAFB-&amp;gt;FlyWire"><title>Map points between FlyWire v1 and FAFB14 space (xyz nm) — flywire2fafb • fafbseg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Map points between FlyWire v1 and FAFB14 space (xyz nm) — flywire2fafb"><meta property="og:description" content="flywire2fafb maps points FlyWire-&amp;gt;FAFB
fafb2flywire maps points FAFB-&amp;gt;FlyWire"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fafbseg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.13.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a>
    <a class="dropdown-item" href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a>
    <a class="dropdown-item" href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a>
    <a class="dropdown-item" href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a>
    <a class="dropdown-item" href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a>
    <a class="dropdown-item" href="../articles/fafbseg-catmaid-legacy-info.html">fafbseg-catmaid-legacy-info</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../SUPPORT.html">Help</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://natverse.org/">natverse</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/natverse/fafbseg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Map points between FlyWire v1 and FAFB14 space (xyz nm)</h1>
      <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/HEAD/R/flywire-coord.R" class="external-link"><code>R/flywire-coord.R</code></a></small>
      <div class="d-none name"><code>flywire2fafb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>flywire2fafb</code> maps points FlyWire-&gt;FAFB</p>
<p><code>fafb2flywire</code> maps points FAFB-&gt;FlyWire</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flywire2fafb</span><span class="op">(</span></span>
<span>  <span class="va">xyz</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mapmany"</span>, <span class="st">"map1"</span><span class="op">)</span>,</span>
<span>  chunksize <span class="op">=</span> <span class="fl">40000</span>,</span>
<span>  swap <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fafb2flywire</span><span class="op">(</span></span>
<span>  <span class="va">xyz</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mapmany"</span>, <span class="st">"map1"</span><span class="op">)</span>,</span>
<span>  chunksize <span class="op">=</span> <span class="fl">40000</span>,</span>
<span>  swap <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>xyz</dt>
<dd><p>A Nx3 matrix of points</p></dd>


<dt>method</dt>
<dd><p>Whether to map many points at once (default) or just one</p></dd>


<dt>chunksize</dt>
<dd><p>The number of points to send to the server when mapping many
points at once.</p></dd>


<dt>swap</dt>
<dd><p>When <code>TRUE</code> applies the deformation field in the opposite
direction e.g. to give a coarse mapping of points FAFB-&gt;FlyWire. This is
wrong but may be useful.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">httr::GET</a></code>/<code>POST</code>
operation</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an Nx3 matrix of points</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that you can also access FlyWire&lt;-&gt;FAFB bridging registrations
  via the <code>xform_brain</code> series of functions. This will allow you
  to transform most kinds of 3D data objects, whereas the <code>flywire2fafb</code>
  function is restricted to plain 3D coordinates. See examples.</p>
<p>Mapping single points is unlikely to be useful, but you may wish to adjust
  the <code>chunksize</code> argument to send more points at once at the risk of
  possible server timeouts. The default value is quite conservative.</p>
<p>When <code>swap=TRUE</code> displacements will be applied in the opposite
  direction to what is intended. This can be used to provide a coarse inverse
  mapping if you feed in FAFB points. This is wrong but was useful before the
  inverse mapping was available as it can get you closer to the right place
  in FlyWire than just assuming that FAFB14 and FlyWire are in the same
  space. This works because deformations are mostly fairly smooth at the
  scale of FAFB-FlyWire displacements. Operationally we find that residual
  displacements are typically of the order 100 nm using this procedure. Since
  2020-08-08 we have a real inverse available, so this is now only of
  historical interest.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># identified location in FAFB14</span></span></span>
<span class="r-in"><span><span class="va">p.fafb.nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">477042</span>, <span class="fl">284535</span>, <span class="fl">90680</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p.fafb.raw</span> <span class="op">&lt;-</span> <span class="va">p.fafb.nm</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># corresponding location in FlyWire</span></span></span>
<span class="r-in"><span><span class="va">p.flywire.raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">118865</span>, <span class="fl">71338</span>, <span class="fl">2267</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p.flywire.nm</span> <span class="op">&lt;-</span> <span class="va">p.flywire.raw</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check displacement</span></span></span>
<span class="r-in"><span><span class="fu">flywire2fafb</span><span class="op">(</span><span class="va">p.flywire.nm</span><span class="op">)</span><span class="op">-</span><span class="va">p.fafb.nm</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      X  Y Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 3 -1 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check what happens when you apply the inverse</span></span></span>
<span class="r-in"><span><span class="fu">fafb2flywire</span><span class="op">(</span><span class="va">p.fafb.nm</span><span class="op">)</span><span class="op">-</span><span class="va">p.flywire.nm</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       X Y Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -3 2 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"AV4b1"</span>, package<span class="op">=</span><span class="st">'catmaid'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">before</span><span class="op">=</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">AV4b1</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nvertices.html" class="external-link">nvertices</a></span><span class="op">(</span><span class="va">AV4b1</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">after</span><span class="op">=</span><span class="fu">fafb2flywire</span><span class="op">(</span><span class="va">before</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="op">(</span><span class="va">before</span><span class="op">-</span><span class="va">after</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">d</span>, br<span class="op">=</span><span class="fl">20</span>, main<span class="op">=</span><span class="st">"FAFB14 - FlyWire Displacements"</span>, xlab<span class="op">=</span><span class="st">"d /nm"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="flywire2fafb-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">AV4b1.flywire</span> <span class="op">&lt;-</span> <span class="fu">xform_brain</span><span class="op">(</span><span class="va">AV4b1</span>, reference<span class="op">=</span><span class="st">"FlyWire"</span>, sample<span class="op">=</span><span class="st">"FAFB14"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot3d</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/neuronlist.html" class="external-link">neuronlist</a></span><span class="op">(</span><span class="va">AV4b1.flywire</span>, <span class="va">AV4b1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

