% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flytable-cache.R
\name{flytable_cached_table}
\alias{flytable_cached_table}
\title{Get a complete flytable table with disk caching and delta sync}
\usage{
flytable_cached_table(
  table,
  expiry = 300,
  refresh = FALSE,
  collapse_lists = TRUE,
  base = NULL,
  limit = 100000L
)
}
\arguments{
\item{table}{Table name (e.g., "info", "optic", "testfruit")}

\item{expiry}{Seconds before checking for updates (default 300 = 5 minutes).
Set to 0 to always check for updates, \code{Inf} to never check.}

\item{refresh}{Logical. If \code{TRUE}, forces a complete re-download
ignoring any cached data. Default \code{FALSE}.}

\item{collapse_lists}{Logical. If \code{TRUE} (default), collapses
multi-select columns into comma-separated strings. Passed to
\code{\link{flytable_query}}.}

\item{base}{Optional base name if table name is ambiguous (exists in multiple
bases).}

\item{limit}{An optional limit, which only applies if you do not specify a
limit directly in the \code{sql} query. By default seatable limits SQL
queries to 100 rows. We increase the limit to 100000 rows by default.}
}
\value{
A \code{data.frame} containing all rows from the table. Has an
  \code{mtime} attribute recording the server timestamp at last sync.
}
\description{
Fetches a complete flytable table using disk caching with
  intelligent delta synchronization. On first call, downloads the full table.
  On subsequent calls within \code{expiry} seconds, returns cached data.
  After expiry, performs delta sync fetching only rows modified since last
  sync based on the \code{_mtime} column.
}
\details{
The function uses the same disk cache infrastructure as
  \code{\link{flywire_leaves}}. The cache location can be controlled via the
  \code{fafbseg.cachedir} option.

  Delta synchronization works by:
  \enumerate{
    \item Checking if cached data exists and is within the expiry window
    \item If expired, querying rows where \code{_mtime > cached_mtime}
    \item Updating modified rows, appending new rows
    \item Detecting and removing deleted rows via row count comparison
  }

  Error handling:
  \itemize{
    \item Connection failures during sync: returns cached data with warning
    \item Schema changes (columns differ): forces full refresh
    \item Corrupted cache: clears and re-fetches
  }
}
\examples{
\dontrun{
# First call - full fetch
info <- flytable_cached_table("info")

# Subsequent call within 5 min - returns cached data
info2 <- flytable_cached_table("info")

# Force check for updates (ignores expiry window)
info3 <- flytable_cached_table("info", expiry = 0)

# Force complete re-download
info4 <- flytable_cached_table("info", refresh = TRUE)

# Check when data was last synced
attr(info, "mtime")
}
}
\seealso{
\code{\link{flytable_query}}, \code{\link{flytable_list_rows}}

Other flytable: 
\code{\link{flytable-queries}},
\code{\link{flytable_list_selected}()},
\code{\link{flytable_login}()},
\code{\link{flytable_update_rows}()}
}
\concept{flytable}
