<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Accessing the chunked graph server • fafbseg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Accessing the chunked graph server">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fafbseg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.15.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a></li>
    <li><a class="dropdown-item" href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a></li>
    <li><a class="dropdown-item" href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a></li>
    <li><a class="dropdown-item" href="../articles/fafbseg-catmaid-legacy-info.html">fafbseg-catmaid-legacy-info</a></li>
    <li><a class="dropdown-item" href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a></li>
    <li><a class="dropdown-item" href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../SUPPORT.html">Help</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://natverse.org/">natverse</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natverse/fafbseg"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Accessing the chunked graph server</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/master/vignettes/articles/accessing-graphene-server.Rmd" class="external-link"><code>vignettes/articles/accessing-graphene-server.Rmd</code></a></small>
      <div class="d-none name"><code>accessing-graphene-server.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="tldr">tl;dr<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<p>To set up programmatic access to FlyWire, use
<code><a href="../reference/flywire_set_token.html">flywire_set_token()</a></code> as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/fafbseg" class="external-link">fafbseg</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/flywire_set_token.html">flywire_set_token</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>and follow the on-screen prompts.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The main goal of connectomics is to trace (segment) the branching
morphology of neurons in any 3D volume (typically based on electron
microscopy) and to identify the connections (synapses) between them that
together define a connectome.</p>
<p>Neuron segmentation can be either skeleton-based (in which only the
centre line defining each part of the neuronal arbour is traced out) or
voxel-based, where a filled 3D structure is defined by labelling every
voxel with an integer id, representing its membership of particular
object; this is typically then displayed as a 3D mesh surface. Although
skeleton-based segmentation is more efficient for manual segmentation by
humans, voxel-wise segmentation is more natural for machine learning
algorithms. Furthermore, it generates a richer representation of the
neuron (capturing more of its structural features) and, crucially, also
resolves ambiguities about object identity. For example when two users
manually trace a neuron skeleton, they will place nodes in different
positions and it is not trivial computationally to determine if they are
part of the same object or how to join tracing of independent pieces
together. In contrast in a voxel-wise segmentation every xyz location in
the image is explicitly defined to be part of a specified object.</p>
<p>In a voxel-wise segmentation, each neuron can be considered as a
collection of voxels grouped together as connected components. Machine
learning based algorithms try to identify such connected components
(e.g. using flood filling networks). However machines are not perfect
and many segments are wrongly connected. Hence we need a step where
humans proofread the segments and alters the connections. These
connected components can be readily represented as vertices and the
connections between them as edges. The human observer essentially
modifies these edges in the graph structure. Note that this graph
representation of object segmentation is distinct from the binary tree
that represents the neuronal morphology or the connection graph of
neurons within a neural network.</p>
<p>This graph based representation of segmentation also has advantages
for synchronous editing, which can be a major technical issue if many
users are to generate or proof-read segmentation at the same time. The
<code>CATMAID</code> web application (for skeleton based tracing)
approaches this by allowing multiple users to edit all neurons using a
shared database. This implementation reduces conflicts by the simple
expedient of allowing users to see each other’s work in real time.
However an explicit merge step is needed when conflicting annotations
are created (usually because editing has happened in different database)
and this can be computationally complex. The <a href="https://seunglab.org/" class="external-link">Seung Lab</a> has developed a data
structure system called <code>chunked graph</code> that lets users
modify segmentations (3D voxel-wise) in real-time and allows access to
earlier versions of the segmentation. A brief overview of the system is
published in <a href="https://medium.com/princeton-systems-course/building-a-multi-user-platform-for-real-time-very-large-graph-editing-ee37268025ad" class="external-link">medium</a>.</p>
<p>In practice an initial <em>over-segmentation</em> is generated,
consisting of many “supervoxels”. These supervoxels, which are small
collections of perhaps tens to thousands of individual voxels, are
effectively immutable but are almost certain to belong to the same
object. It is these supervoxels which are the leaves on the graph
database representation of segmented objects. The use of supervoxels
reduces the size of the graph database compared with the situation in
which individual voxel has to be represented. So long as human
proof-reading is based on the same base segmentation, there are
strategies to merge proof-reading even if this happens asynchronously.
However merging proof-reading based on different <em>base
segmentations</em> defined by different underlying supervoxels is still
complex; a similar challenge exists if it is necessary to map
proof-reading based on one base segmentation to a newer (presumably
improved) base segmentation.</p>
</div>
<div class="section level2">
<h2 id="goal">Goal<a class="anchor" aria-label="anchor" href="#goal"></a>
</h2>
<p>One of the goals in the <strong>fafbseg</strong> package is to
provide access between different 3D segmentations of the
<code>FAFB</code> dataset. Currently available segmentations include
<code>FlyWire</code> (based on 3D CNNs : <a href="https://arxiv.org/abs/1709.02974" class="external-link">U-Net</a>) and
<code>GoogleBrain</code> (based on recursive CNNs : <a href="https://www.nature.com/articles/s41592-018-0049-4" class="external-link">flood-filling
networks</a>). Furthermore to enable location transfer and comparison
with <code>CATMAID</code> (skeleton based) manual reconstruction. In
order to achieve that one needs access to the 3D segmentations which are
stored in a graph database <a href="https://github.com/seung-lab/PyChunkedGraph" class="external-link">Graphene/PyChunkedGraph</a>.
They also provide a Python tool called <a href="https://github.com/seung-lab/cloud-volume" class="external-link">CloudVolume</a> which
provides programmatic access to the graph database.</p>
</div>
<div class="section level2">
<h2 id="chunkedgraph-token">ChunkedGraph token<a class="anchor" aria-label="anchor" href="#chunkedgraph-token"></a>
</h2>
<div class="section level3">
<h3 id="simple-instructions">Simple Instructions<a class="anchor" aria-label="anchor" href="#simple-instructions"></a>
</h3>
<p>You gain access to the <code>Graphene/Chunkedgraph</code> server by
using a <em>token</em> which is granted to you after you authenticate
via a Google account. The simplest way to do this is by doing</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/fafbseg" class="external-link">fafbseg</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/flywire_set_token.html">flywire_set_token</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will offer to open your browser, generate a new token and save
it in a standard location. <strong>Note that this will invalidate your
previous token</strong>!</p>
</div>
<div class="section level3">
<h3 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h3>
<p>The manual steps that <code><a href="../reference/flywire_set_token.html">flywire_set_token()</a></code> tries to
automate are are as follows</p>
<ol style="list-style-type: decimal">
<li>Visit <a href="https://globalv1.flywire-daf.com/auth/api/v1/refresh_token" class="external-link uri">https://globalv1.flywire-daf.com/auth/api/v1/refresh_token</a>,</li>
<li>Copy the token present there, let’s say it was
<code>"xxyyzz"</code>
</li>
<li>create a file named <code>cave-secret.json</code> at location
<code>~/.cloudvolume/secrets/cave-secret.json</code>. For example, in
Terminal:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .cloudvolume/secrets/</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">touch</span> ~/.cloudvolume/secrets/cave-secret.json</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">open</span> ~/.cloudvolume/secrets/cave-secret.json <span class="at">-e</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Paste in the following contents</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="dt">"token"</span><span class="fu">:</span> <span class="st">"xxyyzz"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Save the file</li>
<li>Now you have access to the chunked graph server</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
