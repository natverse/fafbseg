<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>fafbseg-catmaid-legacy-info • fafbseg</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="fafbseg-catmaid-legacy-info">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fafbseg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.15.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a></li>
    <li><a class="dropdown-item" href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a></li>
    <li><a class="dropdown-item" href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a></li>
    <li><a class="dropdown-item" href="../articles/fafbseg-catmaid-legacy-info.html">fafbseg-catmaid-legacy-info</a></li>
    <li><a class="dropdown-item" href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a></li>
    <li><a class="dropdown-item" href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../SUPPORT.html">Help</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://natverse.org/">natverse</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natverse/fafbseg"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>fafbseg-catmaid-legacy-info</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/master/vignettes/fafbseg-catmaid-legacy-info.Rmd" class="external-link"><code>vignettes/fafbseg-catmaid-legacy-info.Rmd</code></a></small>
      <div class="d-none name"><code>fafbseg-catmaid-legacy-info.Rmd</code></div>
    </div>

    
    
<p>This vignette includes information about interacting with FAFB
catmaid and Google autosegmentation services which is now principally of
historical interest.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/fafbseg" class="external-link">fafbseg</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="neuroglancer-urls">Neuroglancer URLs<a class="anchor" aria-label="anchor" href="#neuroglancer-urls"></a>
</h3>
<p>You can use the package to generate URLs pointing to a defined
location in a neuroglancer dataset. This includes arbitrary locations in
the FAFB dataset specified interactively or using CATMAID URLs. For
example, we could find the location referenced in this tweet:</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Zoom into <a href="https://twitter.com/dddavi?ref_src=twsrc%5Etfw" class="external-link"><span class="citation">@dddavi</span></a> whole fly brain EM dataset using
public <a href="https://twitter.com/catmaid?ref_src=twsrc%5Etfw" class="external-link"><span class="citation">@catmaid</span></a> server hosted by
<a href="https://twitter.com/virtualflybrain?ref_src=twsrc%5Etfw" class="external-link"><span class="citation">@virtualflybrain</span></a>. From whole brain view to
synaptic detail. Click to explore this location within the the mushroom
body parallel fibre system yourself!
<a href="https://t.co/JxsBGe3RbJ" class="external-link">https://t.co/JxsBGe3RbJ</a>
<a href="https://twitter.com/flyconnectome?ref_src=twsrc%5Etfw" class="external-link"><span class="citation">@flyconnectome</span></a>
<a href="https://t.co/NfDiXgJOPX" class="external-link">pic.twitter.com/NfDiXgJOPX</a>
</p>
— Greg Jefferis (<span class="citation">@gsxej</span>)
<a href="https://twitter.com/gsxej/status/1021743042296983552?ref_src=twsrc%5Etfw" class="external-link">July
24, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/fafbseg" class="external-link">fafbseg</a></span><span class="op">)</span></span>
<span><span class="co"># First, optionally set a package option with an example neuroglancer URL for your dataset.</span></span>
<span><span class="co"># This URL will define the image layers that are visible. You need to use an</span></span>
<span><span class="co"># URL for which you have access. The package ships with a default using segmentation</span></span>
<span><span class="co"># fafb_v14:fafb_v14_16nm_v00c_split3xfill2 which is probably what you need.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>fafbseg.sampleurl<span class="op">=</span><span class="st">"https://&lt;neuroglancerlurl&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now open location specified by CATMAID URL</span></span>
<span><span class="va">u</span><span class="op">=</span><span class="st">'https://fafb.catmaid.virtualflybrain.org/?pid=2&amp;zp=131280&amp;yp=170014.98879622458&amp;xp=426584.81386896875&amp;tool=navigator&amp;sid0=2&amp;s0=-1'</span></span>
<span><span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or display raw coordinates that you can paste into active Neuroglancer session</span></span>
<span><span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="va">u</span>, coords.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>You can use the same approach for <a href="https://flywire.ai" class="external-link uri">https://flywire.ai</a> URLs with the additional option of
transforming the coordinates to get closer to the correct location in
the FlyWire assembly of the FAFB data (which is typically a few hundred
nm off). See <code><a href="../reference/flywire2fafb.html">flywire2fafb()</a></code> for details.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># opens a new browser tab</span></span>
<span><span class="fu"><a href="../reference/choose_segmentation.html">with_segmentation</a></span><span class="op">(</span><span class="st">'flywire31'</span>, </span>
<span>  <span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="va">u</span>, sample <span class="op">=</span> <span class="st">'FAFB14'</span>, reference <span class="op">=</span> <span class="st">"FlyWire"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># writes coordinates to clipboard so that you can paste them into an existings</span></span>
<span><span class="co"># flywire neuroglancer browser tab</span></span>
<span><span class="fu"><a href="../reference/choose_segmentation.html">with_segmentation</a></span><span class="op">(</span><span class="st">'flywire31'</span>, </span>
<span>  <span class="fu">clipr</span><span class="fu">::</span><span class="fu"><a href="http://matthewlincoln.net/clipr/reference/write_clip.html" class="external-link">write_clip</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="va">u</span>, coords.only <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>      sample <span class="op">=</span> <span class="st">'FAFB14'</span>, reference <span class="op">=</span> <span class="st">"FlyWire"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="catmaid-urls">CATMAID URLs<a class="anchor" aria-label="anchor" href="#catmaid-urls"></a>
</h3>
<p>You can also go in the opposite direction to convert a neuroglancer
location into a CATMAID URL. The neuroglancer location can come either
from a URL or the JSON scene specification obtained by clicking on the
<em>{}</em> icon.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># round trip using the CATMAID URL we used earlier</span></span>
<span><span class="va">ngu</span> <span class="op">=</span> <span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="va">u</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now open using elmr package - installed like so if necessary: </span></span>
<span><span class="co"># natmanager::install(pkgs="natverse/elmr")</span></span>
<span><span class="fu">elmr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/elmr/man/open_fafb.html" class="external-link">open_fafb</a></span><span class="op">(</span><span class="fu"><a href="../reference/ngl_decode_scene.html">ngl_decode_scene</a></span><span class="op">(</span><span class="va">ngu</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="shiny-application">Shiny application<a class="anchor" aria-label="anchor" href="#shiny-application"></a>
</h3>
<p>The package now includes a simple Shiny application that translates
between the two URL schemes. You can use an online version of the app
at</p>
<p><a href="https://jefferislab.shinyapps.io/CATMAID-Neuroglancer-Converter/" class="external-link uri">https://jefferislab.shinyapps.io/CATMAID-Neuroglancer-Converter/</a></p>
<p>or download from GitHub and run locally the latest version of the
app:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://shiny.posit.co/" class="external-link">"shiny"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"shiny"</span><span class="op">)</span></span>
<span><span class="fu">shiny</span><span class="fu">::</span><span class="fu">runGitHub</span><span class="op">(</span><span class="st">"natverse/fafbseg"</span>, subdir <span class="op">=</span> <span class="st">"inst/app/"</span><span class="op">)</span></span></code></pre></div>
<p>Currently the application does not convert FlyWire&lt;-&gt;FAFB
coordinates, but this would be a relatively simple addition using
<code><a href="../reference/flywire2fafb.html">flywire2fafb()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="analysis-of-neuroglancer-meshes">Analysis of neuroglancer meshes<a class="anchor" aria-label="anchor" href="#analysis-of-neuroglancer-meshes"></a>
</h3>
<p>Currently the package provides functionality to read neuroglancer
meshes into R and then compare such meshes with traced neuron objects
e.g. from CATMAID. For this you will need to authenticate with an
appropriate API. Alternatively see the article Capturing neuroglancer
meshes from a browser scene.</p>
<p>You can read in meshes for the <a href="https://flywire.ai/" class="external-link">FlyWire
segmentation of FAFB</a> by doing (roughly)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/choose_segmentation.html">choose_segmentation</a></span><span class="op">(</span>release <span class="op">=</span> <span class="st">'flywire31'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">109459</span>, <span class="fl">41305</span>, <span class="fl">5424</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">va6pn</span><span class="op">=</span><span class="fu"><a href="../reference/read_cloudvolume_meshes.html">read_cloudvolume_meshes</a></span><span class="op">(</span><span class="st">"720575940633169983"</span><span class="op">)</span></span>
<span><span class="co"># compare with VFB CATMAID</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/elmr" class="external-link">elmr</a></span><span class="op">)</span></span>
<span><span class="va">va6pn.skel</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/catmaid/man/read.neuron.catmaid.html" class="external-link">read.neurons.catmaid</a></span><span class="op">(</span><span class="st">"name:VA6.*PN"</span><span class="op">)</span></span>
<span><span class="co"># let's take a look at those</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">va6pn</span>, col<span class="op">=</span><span class="st">'grey'</span>, lwd<span class="op">=</span><span class="fl">0.5</span>, type<span class="op">=</span><span class="st">'wire'</span><span class="op">)</span></span>
<span><span class="co"># only plot first neuron on RHS</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">va6pn.skel</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># can also transform the FAFB14 skeleton from VFB to FlyWire coordinates</span></span>
<span><span class="va">va6pn.skel.fw</span> <span class="op">&lt;-</span> <span class="fu">xform_brain</span><span class="op">(</span><span class="va">va6pn.skel</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, reference <span class="op">=</span> <span class="st">'FlyWire'</span>, sample<span class="op">=</span><span class="st">'FAFB14'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nclear3d.html" class="external-link">nclear3d</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">va6pn</span>, col<span class="op">=</span><span class="st">'grey'</span>, lwd<span class="op">=</span><span class="fl">0.5</span>, type<span class="op">=</span><span class="st">'wire'</span><span class="op">)</span></span>
<span><span class="co"># only plot first neuron on RHS</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/plot3d.html" class="external-link">plot3d</a></span><span class="op">(</span><span class="va">va6pn.skel.fw</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p>You can read in meshes for the <a href="http://fafb-ffn1.storage.googleapis.com/landing.html" class="external-link">Google brain
segmentation of FAFB</a> by doing (roughly)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/choose_segmentation.html">choose_segmentation</a></span><span class="op">(</span>release <span class="op">=</span> <span class="st">'20190805'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/open_fafb_ngl.html">open_fafb_ngl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">109459</span>, <span class="fl">41305</span>, <span class="fl">5424</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">va6pn</span><span class="op">=</span><span class="fu"><a href="../reference/read_brainmaps_meshes.html">read_brainmaps_meshes</a></span><span class="op">(</span><span class="st">"710435991"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
