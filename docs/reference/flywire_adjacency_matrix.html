<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fetch the synaptic adjacency matrix for a set of flywire neurons — flywire_adjacency_matrix • fafbseg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fetch the synaptic adjacency matrix for a set of flywire neurons — flywire_adjacency_matrix"><meta property="og:description" content="Get an adjacency matrix for the predicted synaptic connectivity
  within a set of specific flywire bodies. You can specify a single pool of
  ids or separate input (upstream) and output (downstream) ids. In contrast
  to flywire_partner_summary this only returns connections
  amongst a defined set of ids rather than all possible partners."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fafbseg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a>
    </li>
    <li>
      <a href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a>
    </li>
    <li>
      <a href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a>
    </li>
    <li>
      <a href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a>
    </li>
    <li>
      <a href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../SUPPORT.html">Help</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://natverse.org/" class="external-link">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/fafbseg" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fetch the synaptic adjacency matrix for a set of flywire neurons</h1>
    <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/HEAD/R/autosyn.R" class="external-link"><code>R/autosyn.R</code></a></small>
    <div class="hidden name"><code>flywire_adjacency_matrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Get an adjacency matrix for the predicted synaptic connectivity
  within a set of specific flywire bodies. You can specify a single pool of
  ids or separate input (upstream) and output (downstream) ids. In contrast
  to <code><a href="flywire_partners.html">flywire_partner_summary</a></code> this only returns connections
  amongst a defined set of ids rather than all possible partners.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flywire_adjacency_matrix</span><span class="op">(</span></span>
<span>  rootids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inputids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outputids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  remove_autapses <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cleft.threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  Verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"spine"</span>, <span class="st">"sqlite"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>rootids</dt>
<dd><p>flywire root ids for the bodies to fetch all by all
connectivity information.</p></dd>


<dt>inputids, outputids</dt>
<dd><p>identifiers for input and output bodies (use as an
alternative to <code>rootids</code>)</p></dd>


<dt>sparse</dt>
<dd><p>Whether to return a sparse matrix (default <code>FALSE</code>)</p></dd>


<dt>remove_autapses</dt>
<dd><p>whether to remove autapses (self-connections); most of
these are erroneous.</p></dd>


<dt>cleft.threshold</dt>
<dd><p>A threshold for the cleft score calculated by Buhmann
et al 2019 (default 0, we have used 30-100 to increase specificity)</p></dd>


<dt>Verbose</dt>
<dd><p>Logical indication whether to print status messages during the
query (default <code>T</code> when interactive, <code>F</code> otherwise).</p></dd>


<dt>method</dt>
<dd><p>Whether to use a local SQLite database or remote spine service
for synapse data. The default <code>auto</code> uses a local database when
available (45GB but faster).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A matrix with named rows of inputs and columns of outputs. The matrix
  will be square when rootids is specified but may otherwise be rectangular.
  Defaults to a regular (dense) matrix unless <code>sparse=TRUE</code>.</p>
    </div>
    <div id="limitations">
    <h2>Limitations</h2>
    <p>This function is currently much more efficient when
  local SQLite tables are available; in their absence queries to the remote
  <em>spine</em> server are possible but currently transfer more data than
  necessary. Future work could allow <em>spine</em> queries than consider both
  pre and postsynaptic supervoxel ids as part of the query.</p>
<p>You should also be careful about how many neurons you attempt to query. The
  function is not designed to handle queries involving hundreds of neurons
  with the spine method being especially sensitive to overloading. If this is
  your intention, you might be better off using
  <code><a href="flywire_partners.html">flywire_partners</a></code> or <code><a href="flywire_partners.html">flywire_partner_summary</a></code>
  both of which fetch data in chunks and then manually filtering down to your
  ensemble of interest.</p>
    </div>
    <div id="normalisation">
    <h2>Normalisation</h2>
    <p>It is always important to give careful thought to
  data normalisation when analysing these connectivity matrices. In general
  we feel that normalising by the total input onto each target cell makes the
  most sense, since this approximates the effectiveness of input in making
  the target cell fire. However if you do not include all inputs onto the
  target cells then even this normalisation has difficulties and it may be
  better to use raw counts.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other automatic-synapses: 
<code><a href="flywire_neurons_add_synapses.html">flywire_neurons_add_synapses</a>()</code>,
<code><a href="flywire_ntplot.html">flywire_ntplot</a>()</code>,
<code><a href="flywire_ntpred.html">flywire_ntpred</a>()</code>,
<code><a href="flywire_partners.html">flywire_partners</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">u</span><span class="op">=</span><span class="st">"https://ngl.flywire.ai/?json_url=https://globalv1.flywire-daf.com/nglstate/5392055178100736"</span></span></span>
<span class="r-in"><span><span class="va">sm</span><span class="op">=</span><span class="fu">flywire_adjacency_matrix</span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># scaled to give proportion of inputs onto each target cell</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">sm</span>, scale<span class="op">=</span><span class="st">'col'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="flywire_adjacency_matrix-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># scale='none' =&gt; raw counts</span></span></span>
<span class="r-in"><span><span class="co"># nb note use of assignment and keep.dendro so we can use dendrogram later</span></span></span>
<span class="r-in"><span><span class="va">h</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">sm</span>, scale<span class="op">=</span><span class="st">'none'</span>, keep.dendro <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="flywire_adjacency_matrix-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># same but with the cleft threshold applied</span></span></span>
<span class="r-in"><span><span class="va">smc</span><span class="op">=</span><span class="fu">flywire_adjacency_matrix</span><span class="op">(</span><span class="va">u</span>, cleft.threshold <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># note the reuse of the earlier dendrogram to return col order for comparison</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">smc</span>, scale<span class="op">=</span><span class="st">'none'</span>, Colv<span class="op">=</span><span class="va">h</span><span class="op">$</span><span class="va">Colv</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="flywire_adjacency_matrix-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># just a single upstream neuron</span></span></span>
<span class="r-in"><span><span class="va">sm2</span><span class="op">=</span><span class="fu">flywire_adjacency_matrix</span><span class="op">(</span>inputids<span class="op">=</span><span class="st">"720575940625862385"</span>, outputids<span class="op">=</span><span class="va">u</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

