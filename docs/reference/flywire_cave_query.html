<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Query the FlyWire CAVE annotation system — flywire_cave_query • fafbseg</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Query the FlyWire CAVE annotation system — flywire_cave_query"><meta property="og:description" content="Query the FlyWire CAVE annotation system"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fafbseg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FAFB-FlyWire.html">FAFB-FlyWire</a>
    </li>
    <li>
      <a href="../articles/accessing-graphene-server.html">Accessing the chunked graph server</a>
    </li>
    <li>
      <a href="../articles/capturing-ngl-meshes.html">Capturing neuroglancer meshes from a browser scene</a>
    </li>
    <li>
      <a href="../articles/installing-cloudvolume-meshparty.html">Installing python modules: cloudvolume, meshparty and skeletor</a>
    </li>
    <li>
      <a href="../articles/mesh-to-mesh.html">Mesh to mesh distances</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../SUPPORT.html">Help</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://natverse.org/" class="external-link">natverse</a>
</li>
<li>
  <a href="https://github.com/natverse/fafbseg" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query the FlyWire CAVE annotation system</h1>
    <small class="dont-index">Source: <a href="https://github.com/natverse/fafbseg/blob/HEAD/R/cave.R" class="external-link"><code>R/cave.R</code></a></small>
    <div class="hidden name"><code>flywire_cave_query.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Query the FlyWire CAVE annotation system</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">flywire_cave_query</span><span class="op">(</span></span>
<span>  <span class="va">table</span>,</span>
<span>  datastack_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"fafbseg.cave.datastack_name"</span>, <span class="st">"flywire_fafb_production"</span><span class="op">)</span>,</span>
<span>  version <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  timestamp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  live <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">version</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">timestamp</span><span class="op">)</span>,</span>
<span>  filter_in_dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_out_dict <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>table</dt>
<dd><p>The name of the table to query</p></dd>


<dt>datastack_name</dt>
<dd><p>defaults to "flywire_fafb_production". See
<a href="https://global.daf-apis.com/info/" class="external-link">https://global.daf-apis.com/info/</a> for other options.</p></dd>


<dt>version</dt>
<dd><p>An optional CAVE materialisation version
number. See details and examples.</p></dd>


<dt>timestamp</dt>
<dd><p>An optional timestamp as a string or POSIXct, interpreted as
UTC when no timezone is specified.</p></dd>


<dt>live</dt>
<dd><p>Whether to use live query mode, which updates any root ids to
their current value.</p></dd>


<dt>filter_in_dict, filter_out_dict</dt>
<dd><p>Optional arguments consisting of key
value lists that restrict the returned rows (keeping only matches or
filtering out matches). See examples and CAVE documentation for details.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments to the query method. See examples and
details.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>tibble</code>. Note that xyzmatrix can be used on single columns
  containing XYZ locations.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>CAVE (Connectome Annotation Versioning Engine) provides a shared
  infrastructure for a number of connectomics projects involving Sebastian
  Seung's group at Princeton and collaborators at the Allen Institute. There
  is both a backend system running on their servers and a Python client for
  end users.</p>
<p>You can find out more at <a href="https://caveclient.readthedocs.io/" class="external-link">https://caveclient.readthedocs.io/</a> as well
  as looking at the Python notebooks on the github repo
  <a href="https://github.com/seung-lab/CAVEclient" class="external-link">https://github.com/seung-lab/CAVEclient</a>.</p>
<p>The annotation system shares authentication infrastructure with the rest of
  the FlyWire API (see <code><a href="flywire_set_token.html">flywire_set_token</a></code>).</p>
<p>CAVE has a concept of table snapshots identified by an integer
  materialization <code>version</code> number. In some cases you may wish to query
  a table at this defined version number so that you can avoid root_ids
  changing during an analysis. Your calls will also be faster since no root
  id updates are required.</p>
<p>Note however that materialisation versions expire at which point the
  corresponding version of the database is expunged. However it is still
  possible to find the timestamp for an expired materialisation version.
  <code>flywire_cave_query</code> does this automatically using
  <code><a href="flywire_timestamp.html">flywire_timestamp</a></code>. In these circumstances queries will again
  be slower (quite possibly slower than the live query) since all root ids
  must be recalculated to match the timestamp.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="flywire_cave_client.html">flywire_cave_client</a></code></p>
<p>Other cave-queries: 
<code><a href="flywire_timestamp.html">flywire_timestamp</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># note use of limit to restrict the number of rows (must be integer)</span></span></span>
<span class="r-in"><span><span class="va">n10</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'nuclei_v1'</span>, limit<span class="op">=</span><span class="fl">10L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">n10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        id valid    volume  pt_supervoxel_id         pt_root_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 7393349     t 26.141245 82827379285852979 720575940626838909</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 7416439     t 11.523400 82827998029690530 720575940627484553</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 7415038     t 32.895959 83038623024880664 720575940626046919</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 7415013     t 53.711176 83038760463398837 720575940630311383</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 7415848     t  9.280717 83038554439606237 720575940633370649</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 7415851     t 19.018342 83038691811464073 720575940638709326</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              pt_position      bb_start_position        bb_end_position</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  709888, 227744, 57160  708032, 226144, 54760  711904, 229440, 59280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 710592, 263392, 129800 708800, 262112, 128200 712064, 264832, 131080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  722528, 234656, 77000  720768, 232896, 74480  724224, 236576, 79360</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  722912, 244032, 65200  720480, 242144, 62480  725600, 246208, 67760</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 721984, 229792, 119560 720832, 228320, 118240 723232, 231264, 120840</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  722432, 239520, 98440  720864, 237888, 96200 724256, 241056, 100760</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">nuclei_v1</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'nuclei_v1'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">points3d</span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/elmr" class="external-link">elmr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># calculate signed distance to FAFB surface</span></span></span>
<span class="r-in"><span><span class="co"># NB this surface is not a perfect fit in the optic lobes</span></span></span>
<span class="r-in"><span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">d</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/pointsinside.html" class="external-link">pointsinside</a></span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span>, <span class="va">FAFB.surf</span>,</span></span>
<span class="r-in"><span>  rval <span class="op">=</span> <span class="st">'dist'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">points3d</span><span class="op">(</span><span class="fu"><a href="xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">pt_position</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  col<span class="op">=</span><span class="fu">matlab</span><span class="fu">::</span><span class="fu">jet.colors</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">nuclei_v1</span><span class="op">$</span><span class="va">d</span>,<span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot3d</span><span class="op">(</span><span class="va">FAFB</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co"># Example of a query on a table</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># the Princeton (mostly) and Cambridge groups have tagged some bodies as</span></span></span>
<span class="r-in"><span><span class="co"># not a neuron - these are often glia.</span></span></span>
<span class="r-in"><span><span class="va">nans</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span><span class="st">'neuron_information_v2'</span>,</span></span>
<span class="r-in"><span>  filter_in_dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tag<span class="op">=</span><span class="st">'not a neuron'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nans</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nans</span><span class="op">$</span><span class="va">user_id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">psp_351</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'proofreading_status_public_v1'</span>,</span></span>
<span class="r-in"><span>  version<span class="op">=</span><span class="fl">351</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the last listed materialisation version</span></span></span>
<span class="r-in"><span><span class="va">fcc</span><span class="op">=</span><span class="fu"><a href="flywire_cave_client.html">flywire_cave_client</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lastv</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">fcc</span><span class="op">$</span><span class="va">materialize</span><span class="op">$</span><span class="fu">get_versions</span><span class="op">(</span><span class="op">)</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># pull that</span></span></span>
<span class="r-in"><span><span class="va">psp_last</span><span class="op">=</span><span class="fu">flywire_cave_query</span><span class="op">(</span>table <span class="op">=</span> <span class="st">'proofreading_status_public_v1'</span>,</span></span>
<span class="r-in"><span>  version<span class="op">=</span><span class="va">lastv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

